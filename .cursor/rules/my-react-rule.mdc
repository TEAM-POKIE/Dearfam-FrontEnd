---
description: 
globs: 
alwaysApply: true
---
# ğŸš€ Modern React Performance & Architecture Guide

React 18+, TypeScript, Zustand, TanStack Query, Zodë¥¼ í™œìš©í•œ ìµœì‹  ì„±ëŠ¥ ìµœì í™” ì•„í‚¤í…ì²˜ ê°€ì´ë“œì…ë‹ˆë‹¤.

## ğŸ“‚ í˜ì´ì§€ ì¤‘ì‹¬ í´ë” êµ¬ì¡° (Page-Centric Architecture)

### í˜„ì¬ í”„ë¡œì íŠ¸ êµ¬ì¡° ë¶„ì„
- âœ… `src/pages/` êµ¬ì¡°ë¡œ í˜ì´ì§€ë³„ ê²©ë¦¬ ì´ë¯¸ ì ìš©
- âœ… `components/ui/` ë¡œ UI ì»´í¬ë„ŒíŠ¸ ì²´ê³„í™”
- âœ… `context/store/` ë¡œ ìƒíƒœ ê´€ë¦¬ ë¶„ë¦¬
- âœ… `lib/api.ts` ë¡œ API ë ˆì´ì–´ ë¶„ë¦¬

### ê¶Œì¥ ê°œì„ ì‚¬í•­

```
src/pages/Home/
â”œâ”€â”€ index.tsx           # ë¼ìš°íŒ… ì§„ì…ì 
â”œâ”€â”€ HomeView.tsx        # UI ì»´í¬ë„ŒíŠ¸ (ê¸°ì¡´ ìœ ì§€)
â”œâ”€â”€ HomeViewModel.tsx   # ìƒíƒœ ê´€ë¦¬ ë¡œì§ (ì‹ ê·œ ê¶Œì¥)
â”œâ”€â”€ HomePresenter.tsx   # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (ì‹ ê·œ ê¶Œì¥)
â”œâ”€â”€ components/         # í˜ì´ì§€ ì „ìš© ì»´í¬ë„ŒíŠ¸
â””â”€â”€ hooks/              # í˜ì´ì§€ ì „ìš© í›…
```

## âš¡ React 18+ ì„±ëŠ¥ ìµœì í™” íŒ¨í„´

### 1. ë©”ëª¨ì´ì œì´ì…˜ íŠ¸ë¦¬í”Œ ì¡°í•©
```typescript
// React.memo + useMemo + useCallback
const OptimizedComponent = React.memo(({ data, onUpdate }) => {
  const processedData = useMemo(() => 
    data.map(item => expensiveCalculation(item)), [data]
  );
  
  const handleUpdate = useCallback((id: string) => {
    onUpdate(id);
  }, [onUpdate]);

  return <div>{/* ë Œë”ë§ */}</div>;
});
```

### 2. Concurrent Features í™œìš©
```typescript
import { startTransition, useDeferredValue } from 'react';

// ê¸‰í•˜ì§€ ì•Šì€ ì—…ë°ì´íŠ¸ ì§€ì—°
function SearchResults({ query }) {
  const deferredQuery = useDeferredValue(query);
  // ê²€ìƒ‰ ê²°ê³¼ ë Œë”ë§
}

// ë¹„ë™ê¸° ìƒíƒœ ì—…ë°ì´íŠ¸
function updateData(newData) {
  startTransition(() => {
    setData(newData);
  });
}
```

### 3. ì§€ì—° ë¡œë”© ë° ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…
```typescript
// í˜ì´ì§€ ë ˆë²¨ ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…
const LazyPage = lazy(() => import('./LazyPage'));

// ì»´í¬ë„ŒíŠ¸ ë ˆë²¨ ì§€ì—° ë¡œë”©
const LazyChart = lazy(() => import('./Chart'));

// ì‚¬ìš©
<Suspense fallback={<LoadingSpinner />}>
  <LazyChart />
</Suspense>
```

## ğŸ—„ï¸ Zustand ìµœì í™” íŒ¨í„´

### ì„ íƒì  êµ¬ë…ìœ¼ë¡œ ë¦¬ë Œë”ë§ ìµœì†Œí™”
```typescript
// lib/store/optimizedStore.ts
import { create } from 'zustand';
import { subscribeWithSelector, devtools } from 'zustand/middleware';

export const useOptimizedStore = create<State>()(
  devtools(
    subscribeWithSelector((set, get) => ({
      // ìƒíƒœ ì •ì˜
      user: null,
      ui: { loading: false },
      
      // ì•¡ì…˜ - ì„±ëŠ¥ ìµœì í™”ëœ ì—…ë°ì´íŠ¸
      setUser: (user) => set({ user }, false, 'setUser'),
      
      // ë¹„ë™ê¸° ì•¡ì…˜ - ì—ëŸ¬ ì²˜ë¦¬ í¬í•¨
      updateUserProfile: async (data) => {
        set({ ui: { loading: true } });
        try {
          const user = await updateProfile(data);
          set({ user, ui: { loading: false } });
        } catch (error) {
          set({ ui: { loading: false, error: error.message } });
        }
      }
    }))
  )
);

// ì»´í¬ë„ŒíŠ¸ì—ì„œ ì„ íƒì  êµ¬ë…
function UserProfile() {
  const user = useOptimizedStore((state) => state.user);
  const isLoading = useOptimizedStore((state) => state.ui.loading);
  // í•„ìš”í•œ ìƒíƒœë§Œ êµ¬ë…í•˜ì—¬ ë¦¬ë Œë”ë§ ìµœì†Œí™”
}
```

### ìƒíƒœ í†µí•© íŒ¨í„´
```typescript
// âŒ í”¼í•˜ê¸°: ë¶„ì‚°ëœ ì‘ì€ ìŠ¤í† ì–´ë“¤
const useHeaderStore = create(set => ({ title: '' }));
const useCarouselStore = create(set => ({ index: 0 }));

// âœ… ê¶Œì¥: ê´€ë ¨ ìƒíƒœ í†µí•©
const useUIStore = create<UIState>()(
  devtools((set) => ({
    header: { title: '', showBack: false },
    carousel: { index: 0, autoPlay: true },
    modal: { isOpen: false },
    
    setHeader: (header) => set(state => ({ 
      header: { ...state.header, ...header } 
    })),
  }))
);
```

## ğŸŒ TanStack Query ìµœì í™”

### ì¿¼ë¦¬ í‚¤ íŒ©í† ë¦¬ íŒ¨í„´
```typescript
// lib/api/queryKeys.ts
export const queryKeys = {
  users: ['users'] as const,
  user: (id: string) => ['users', id] as const,
  userPosts: (id: string) => ['users', id, 'posts'] as const,
} as const;
```

### ì„±ëŠ¥ ìµœì í™”ëœ ì¿¼ë¦¬ ì„¤ì •
```typescript
// lib/api/queries.ts
export function useOptimizedUser(id: string) {
  return useQuery({
    queryKey: queryKeys.user(id),
    queryFn: () => fetchUser(id),
    staleTime: 5 * 60 * 1000,      // 5ë¶„ê°„ ì‹ ì„ 
    cacheTime: 10 * 60 * 1000,     // 10ë¶„ê°„ ìºì‹œ
    retry: 3,
    refetchOnWindowFocus: false,
    enabled: !!id,                  // ì¡°ê±´ë¶€ ì‹¤í–‰
  });
}
```

### ë‚™ê´€ì  ì—…ë°ì´íŠ¸ íŒ¨í„´
```typescript
export function useOptimisticUpdate() {
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: updateUser,
    onMutate: async (newData) => {
      await queryClient.cancelQueries({ queryKey: queryKeys.user(newData.id) });
      const previous = queryClient.getQueryData(queryKeys.user(newData.id));
      
      // ë‚™ê´€ì  ì—…ë°ì´íŠ¸
      queryClient.setQueryData(queryKeys.user(newData.id), {
        ...previous,
        ...newData,
      });
      
      return { previous };
    },
    onError: (err, newData, context) => {
      if (context?.previous) {
        queryClient.setQueryData(queryKeys.user(newData.id), context.previous);
      }
    },
    onSettled: (data, error, variables) => {
      queryClient.invalidateQueries({ queryKey: queryKeys.user(variables.id) });
    },
  });
}
```

## ğŸ›¡ï¸ Zod ìŠ¤í‚¤ë§ˆ ìµœì í™”

### ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ìŠ¤í‚¤ë§ˆ ì„¤ê³„
```typescript
// lib/validation/schemas.ts
import { z } from 'zod';

// ê¸°ë³¸ ìŠ¤í‚¤ë§ˆ ì¡°ê°
const emailSchema = z.string().email('ìœ íš¨í•œ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”');
const passwordSchema = z.string()
  .min(8, 'ìµœì†Œ 8ì')
  .regex(/^(?=.*[a-zA-Z])(?=.*\d)/, 'ì˜ë¬¸+ìˆ«ì í¬í•¨');

// ìŠ¤í‚¤ë§ˆ ìºì‹±ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”
export const userSchemas = {
  login: z.object({
    email: emailSchema,
    password: passwordSchema,
  }),
  
  register: z.object({
    email: emailSchema,
    password: passwordSchema,
    confirmPassword: z.string(),
  }).refine((data) => data.password === data.confirmPassword, {
    message: "ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜",
    path: ["confirmPassword"],
  }),
} as const;
```

### React Hook Form í†µí•©
```typescript
function OptimizedForm() {
  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
  } = useForm({
    resolver: zodResolver(userSchemas.login),
    mode: 'onBlur', // ì„±ëŠ¥ ìµœì í™”
  });

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      {/* í¼ í•„ë“œ */}
    </form>
  );
}
```

## ğŸ¨ View-ViewModel-Presenter íŒ¨í„´

### ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë¶„ë¦¬
```typescript
// HomePresenter.tsx - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
export class HomePresenter {
  constructor(
    private readonly eventService: EventService,
    private readonly userStore: UserStore
  ) {}

  async loadHomeData(): Promise<HomeData> {
    const [events, user] = await Promise.all([
      this.eventService.getRecentEvents(),
      this.userStore.getState().user
    ]);
    
    return this.processHomeData(events, user);
  }

  private processHomeData(events: Event[], user: User): HomeData {
    // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬
    return {
      events: events.filter(e => this.canUserViewEvent(e, user)),
      recommendations: this.generateRecommendations(events, user),
    };
  }
}
```

### ìƒíƒœ ê´€ë¦¬ ê³„ì¸µ
```typescript
// HomeViewModel.tsx - ìƒíƒœ ê´€ë¦¬
export function useHomeViewModel() {
  const [data, setData] = useState<HomeData | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  
  const presenter = useMemo(() => new HomePresenter(
    eventService,
    userStore
  ), []);

  const loadData = useCallback(async () => {
    setIsLoading(true);
    try {
      const homeData = await presenter.loadHomeData();
      setData(homeData);
    } catch (error) {
      console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
    } finally {
      setIsLoading(false);
    }
  }, [presenter]);

  return { data, isLoading, loadData };
}
```

### UI ë Œë”ë§ ê³„ì¸µ
```typescript
// HomeView.tsx - UI ë Œë”ë§
export function HomeView() {
  const { data, isLoading, loadData } = useHomeViewModel();

  if (isLoading) return <LoadingSpinner />;
  if (!data) return <EmptyState onRetry={loadData} />;

  return (
    <div>
      <EventList events={data.events} />
      <RecommendationCard items={data.recommendations} />
    </div>
  );
}
```

## ğŸ¯ ì¶”ê°€ ì„±ëŠ¥ ìµœì í™” ê¸°ë²•

### ê°€ìƒí™” ë¦¬ìŠ¤íŠ¸
```typescript
import { FixedSizeList as List } from 'react-window';

function VirtualizedList({ items }) {
  const Row = ({ index, style }) => (
    <div style={style}>
      <ItemComponent item={items[index]} />
    </div>
  );

  return (
    <List height={600} itemCount={items.length} itemSize={50}>
      {Row}
    </List>
  );
}
```

### ì´ë¯¸ì§€ ìµœì í™”
```typescript
function OptimizedImage({ src, alt, ...props }) {
  return (
    <img
      src={src}
      alt={alt}
      loading="lazy"        // ì§€ì—° ë¡œë”©
      decoding="async"      // ë¹„ë™ê¸° ë””ì½”ë”©
      {...props}
    />
  );
}
```

### ìƒíƒœ ì—…ë°ì´íŠ¸ ìµœì í™”
```typescript
import { produce } from 'immer';

const useOptimizedState = () => {
  const [state, setState] = useState(initialState);

  const updateNested = useCallback((path: string, value: any) => {
    setState(produce(draft => {
      draft[path] = value;
    }));
  }, []);

  return { state, updateNested };
};
```

## ğŸ“Š ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì„¤ì •

### ë²ˆë“¤ ë¶„ì„
```typescript
// vite.config.ts
import { visualizer } from 'rollup-plugin-visualizer';

export default defineConfig({
  plugins: [
    visualizer({
      filename: 'bundle-analysis.html',
      open: true,
      gzipSize: true,
    }),
  ],
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
          ui: ['@radix-ui/react-dialog'],
        },
      },
    },
  },
});
```

ì´ ê°€ì´ë“œëŠ” ìµœì‹  React 18+, TypeScript 5+, Zustand 4+, TanStack Query 5+, Zod 3+ ê³µì‹ ë¬¸ì„œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‹¤ì œ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ê²€ì¦ëœ ì„±ëŠ¥ ìµœì í™” íŒ¨í„´ì„ ì œì‹œí•©ë‹ˆë‹¤. 